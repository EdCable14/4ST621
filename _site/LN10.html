<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam Cabla">

<title>4ST621 - Point estimates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">4ST621</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Course_Intro.html" rel="" target="" aria-current="page">
 <span class="menu-text">Course Introduction</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./LN9.html">Mathematical Statistics</a></li><li class="breadcrumb-item"><a href="./LN10.html">Point estimates</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Course_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Probability Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basics of Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random Variable</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Characteristics of Random Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random Vectors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selected Discrete Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selected Continuous Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Two Selected Multivariate Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Stochastic convergences</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Mathematical Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LN10.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Point estimates</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">LN11.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">LN12.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">LN13.qmd</span>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#basic-properties-of-point-estimators" id="toc-basic-properties-of-point-estimators" class="nav-link" data-scroll-target="#basic-properties-of-point-estimators">Basic properties of point estimators</a>
  <ul class="collapse">
  <li><a href="#bias" id="toc-bias" class="nav-link" data-scroll-target="#bias">Bias</a></li>
  <li><a href="#consistency" id="toc-consistency" class="nav-link" data-scroll-target="#consistency">Consistency</a></li>
  <li><a href="#accuracy" id="toc-accuracy" class="nav-link" data-scroll-target="#accuracy">Accuracy</a></li>
  </ul></li>
  <li><a href="#basic-methods-of-construction" id="toc-basic-methods-of-construction" class="nav-link" data-scroll-target="#basic-methods-of-construction">Basic methods of construction</a>
  <ul class="collapse">
  <li><a href="#method-of-moments" id="toc-method-of-moments" class="nav-link" data-scroll-target="#method-of-moments">Method of Moments</a></li>
  <li><a href="#method-of-quantiles" id="toc-method-of-quantiles" class="nav-link" data-scroll-target="#method-of-quantiles">Method of Quantiles</a></li>
  <li><a href="#maximum-likelihood-method" id="toc-maximum-likelihood-method" class="nav-link" data-scroll-target="#maximum-likelihood-method">Maximum likelihood method</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Point estimates</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adam Cabla </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>We will introduce the first basic concepts in point estimates in frequentist statistics. To remind you, frequentist statistics is about long-term properties; here, we introduce the long-term properties of the statistics we use to estimate parameters and the most common methods to construct these statistics.</p>
<p>The <em>long-term</em> in this setting means <em>under repeated sampling</em>. That is, if you repeat the sample of a given size over and over and over, and you write down values of the statistics across this theoretically infinite batch of samples, what are the properties of these statistics? Recall the previous chapter by introducing the characteristics of statistics and their sampling distributions.</p>
<p>First, we need to distinguish three terms:</p>
<p><strong><em>The estimator T</em></strong> is a statistic that is used to estimate something. This is a random variable, and the properties of this random variable are ofinterest.</p>
<p><strong><em>The estimand</em></strong> is what we want to estimate, e.g., the parameter <span class="math inline">\(\theta\)</span> of a chosen probability distribution. This is a constant with no probabilistic properties in our frequentist playbook.</p>
<p><strong><em>The estimate</em></strong>is a realisation; it is the estimator’s specific value, <strong><em>t</em></strong>, calculated in the data.</p>
</section>
<section id="basic-properties-of-point-estimators" class="level2">
<h2 class="anchored" data-anchor-id="basic-properties-of-point-estimators">Basic properties of point estimators</h2>
<p>We instinctively want our estimators to be connected to the estimands somehow. We would like them to have some properties, and we should be aware that there is sometimes even a trade-off between these properties. Intuitively, the estimator should be, on average, as close to the estimand as possible. This closeness can be divided into two properties - how far away it is on the long-term average and how far away it is in its individual realisations (estimates).</p>
<section id="bias" class="level3">
<h3 class="anchored" data-anchor-id="bias">Bias</h3>
<p>The first intuitive property can be written down this way:</p>
<p><span class="math display">\[
E(T)=\theta
\]</span></p>
<p>This means that the expected value of our estimator should be equal to the parameter we are about to estimate with it. The property is called unbiasedness and is often not achieved. But a softer version, called asymptotic unbiasedness, does exist:</p>
<p><span class="math display">\[
E(\textbf{T})\xrightarrow{n\to\infty}\theta
\]</span></p>
<p>We can calculate how far away the expectation is from the reality in the quantification of bias:</p>
<p><span class="math display">\[
b(T)=E(T)-\theta
\]</span></p>
<p>And rewrite both properties as</p>
<p><span class="math display">\[
b(T)=0
\]</span></p>
<p><span class="math display">\[
b(T)\xrightarrow{n\to\infty}0
\]</span></p>
</section>
<section id="consistency" class="level3">
<h3 class="anchored" data-anchor-id="consistency">Consistency</h3>
<p>Bias represents <em>systematic error</em>. The second type of error is <em>random,</em> which we mathematically represent as the variance of the estimator <span class="math inline">\(Var(T)\)</span>.</p>
<p>Now, the consistency property connects the two properties: systematic error, which is zero (unbiasedness) or going down (asymptotic unbiasedness), and random errors, which go down with the increasing number of observations. So, the two necessary and sufficient conditions of consistency are:</p>
<p><span class="math display">\[
b(T)\xrightarrow{n\to\infty}0
\]</span></p>
<p><span class="math display">\[ Var(T)\xrightarrow{n\to\infty}0 \]</span></p>
<p>Consistency means that the more data we observe, the better our <strong><em>estimator</em></strong> is on the long-term average.</p>
</section>
<section id="accuracy" class="level3">
<h3 class="anchored" data-anchor-id="accuracy">Accuracy</h3>
<p>How well is our estimator doing on a long-term average? Since there are two sources of the error, we can combine them to create an overall error evaluation called <em>mean squared</em> error:</p>
<p><span class="math display">\[
MSE(T)=E \left(\left(T-\theta\right)^2\right)=\left(b\left(T\right)\right)^2+Var(T)
\]</span></p>
<p>The mean squared error tells us what the expected squared error of the estimator is regarding the estimated parameter <span class="math inline">\(\theta\)</span>. It is composed of the squared value of the bias and variance of the estimator. If the estimator is unbiased, then the mean squared error is the estimator’s variance only.</p>
<p>Because MSE is, similarly to variance, in squared units of the random variable, it is often considered more useful to communicate its square root called <em>root mean squared error,</em> which is in the units of the random variable:</p>
<p><span class="math display">\[
RMSE(T)=\sqrt{MSE(T)}
\]</span></p>
</section>
</section>
<section id="basic-methods-of-construction" class="level2">
<h2 class="anchored" data-anchor-id="basic-methods-of-construction">Basic methods of construction</h2>
<p>Estimators can be constructed in many ways, ranging from the <em>look outside-of-the-window</em> method to more sophisticated techniques. Generally, the common basic approaches can be divided into two groups: one that matches some theoretical properties of the distribution to similar properties of the data, and the second optimises the selected criterion of fit. From the first group, we will glance at moment-matching and quantile-matching methods; from the second, we will focus on the most commonly applied method - maximum likelihood estimation.</p>
<section id="method-of-moments" class="level3">
<h3 class="anchored" data-anchor-id="method-of-moments">Method of Moments</h3>
<p>The method of moments is based on matching theoretical moments of a given probability distribution with empirical moments calculated in the sample. Take, for example, raw moments:</p>
<p><span class="math display">\[
\mu_k´=\overline{x_k}
\]</span></p>
<p>This method can be adapted to use various types of moments (central, standardised, L-moments, TL-moments,…). Still, in its simple version, you create as many equations as the number of parameters you need to estimate and start from the bottom <span class="math inline">\(k=1,2,...\)</span>.</p>
<p>This method was used for its simplicity and usually yields consistent estimators. On the other hand, the estimators are often worse in terms of accuracy than other options and have some other disadvantages.</p>
<p>It also serves as a teaching introduction to the generalised method of moments applicable under certain conditions or as a first-order solution before proceeding to the maximum likelihood estimate.</p>
</section>
<section id="method-of-quantiles" class="level3">
<h3 class="anchored" data-anchor-id="method-of-quantiles">Method of Quantiles</h3>
<p>Another example of the matching method is the method of quantiles, but instead of matching moments, it matches theoretical quantiles <span class="math inline">\(x_p\)</span> with empirical quantiles <span class="math inline">\(\widetilde{x_p}\)</span> for various values of <em>P</em>.</p>
<p>This method is specifically useful when you want to estimate probability distribution with specific theoretical quantiles of interest, like, e.g.&nbsp;95% quantile of the log-normal distribution for risk estimate.</p>
</section>
<section id="maximum-likelihood-method" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-method">Maximum likelihood method</h3>
<p>The last method of finding estimators in this short list is probably the most common and powerful. Let´s first introduce the concept of likelihood and distinguish it from the joint probability distribution of the sample.</p>
<p>We start with the assumption that our sample comes from a random sampling procedure (or unchanging data-generating process). In such a case, individual values are drawn from a sequence of independent identically distributed random variables, and their joint probability distribution can be written as the product of individual densities which are identical:</p>
<p><span class="math display">\[f(\textbf{x},\theta)=\prod_{i=1}^n f(x_i,\theta)\]</span>This is a probability function of fixed parameter <span class="math inline">\(\theta\)</span> and varying data. This answers the question: What are the probabilities of various datasets if the given parameter has this value?</p>
<p>However, it can´t be presented as varying once the dataset is known and fixed. Still, we can switch the idea and ask a different question: if the given dataset looks like this, what are its probabilities under different possible values of the parameter <span class="math inline">\(\theta\)</span>? That is what the likelihood function presents:</p>
<p><span class="math display">\[
L(x;\theta)=\prod_{i=1}^{n}f(x_i,\theta)
\]</span></p>
<p>To repeat: probability density is the probability of varying data under a fixed value of the parameter; likelihood is the probability of fixed data under a varying value of the parameter.</p>
<p>Maximum likelihood estimators arise from maximising likelihood function; that is, they answer the question: under what value of parameter <span class="math inline">\(\theta\)</span> arise data at hand with the highest probability?</p>
<p>Under some general conditions, the likelihood function is unimodal and its maximum can be found using partial derivations:</p>
<p><span class="math display">\[
\frac{\partial L(\textbf{x},\theta)}{\partial \theta}=0
\]</span></p>
<p>The problem with this is two-fold: analytically, it is quite difficult to find partial derivations of the product. Numerically, this product usually goes too quickly to zero, and the procedure cannot distinguish its value and collapses.</p>
<p>Practically, both of these problems can be solved by using the log-likelihood function, which transforms the product into a sum:</p>
<p><span class="math display">\[
l(\textbf{x};\theta)=log\left(L(\textbf{x};\theta)  \right)=\sum_{i=1}^{n}log(f(x_i;\theta))
\]</span></p>
<p>Because this transformation is monotonic, we can find the maximum at the same point by partial derivation:</p>
<p><span class="math display">\[
\frac{\partial l(\textbf{x};\theta)}{\partial \theta}=0
\]</span></p>
<p>Maximum likelihood estimators are often well-behaved with the following properties:</p>
<ul>
<li><p>(Asymptotically) unbiased</p></li>
<li><p>Consistent</p></li>
<li><p>Asymptotically best linear unbiased estimators (lowest variance among unbiased estimators)</p></li>
<li><p>Asymptotically having normal distribution.</p></li>
</ul>
<p>The last point is vital for inferences about estimands. One can see that these properties are often asymptotical, i.e.&nbsp;they should be considered with caution. But generally speaking, maximum likelihood estimators are usually the optimal way to go for medium to large samples and typically have good properties even for small sample sizes.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>